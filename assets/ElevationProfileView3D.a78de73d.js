import{cv as D,b3 as v,V as _,O as E,cw as b,ax as H,fM as L,dN as P,dj as G,aa as d,dC as V,cJ as k,J as m,K as f,L as M,M as O,G as R,r$ as S,ab as c,cW as T,l as x,aG as z,c1 as C,s0 as I,hs as w,Z as u,rY as y}from"./vendor.c28ea743.js";import{h as A}from"./HoveredPoints.6bde6fd3.js";import{S as $,e as B,y as J}from"./GraphicState.c7116edc.js";import"./colorUtils.7c4b6dc5.js";class U{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null}destroy(){this.remove()}remove(){this._highlightTask=D(this._highlightTask),this._highlightHandle=v(this._highlightHandle),this._visualElementHandle=v(this._visualElementHandle)}showHighlight(e){if(this.remove(),_(e)||!g(e))return;const s=e.layer;this._highlightTask=b(async t=>{const n=await this._params.view.whenLayerView(s);H(t),L(n)&&(this._highlightHandle=n.highlight(e))})}showReshaping(e){if(this.remove(),_(e))return;const s=this._params.view,t=new $({view:s,geometry:g(e)?e.geometry:null,attached:!1,elevationInfo:P(e),renderOccluded:G.OccludeAndTransparentStencil}),n=new B({graphic:e}),i=[d(()=>n.isDraped,l=>{t.isDraped=l}),n.on("changed",()=>{t.geometry=g(e)?e.geometry:null}),s.trackGraphicState(n),s.maskOccludee(e),V(t)];J.visualElements.lineGraphics.outline.apply(t),t.attached=!0,this._visualElementHandle=k(i)}}function g(a){return E(a.geometry)&&a.geometry.type==="polyline"}const W=100;let p=class extends O{constructor(a){super(a),this._chartData=null,this._visualElements=[],this._handles=new R}initialize(){const a=S(e=>{this._update(e)},W);this._handles.add([d(()=>({spatialReference:this.view.spatialReference,chartData:this._chartData}),a,c),a])}destroy(){this._handles.destroy(),this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(a){this._chartData=a}_update(a){const{chartData:e}=a;if(_(e))return this.remove();if(!e.refined)return;const s=this._visualElements,t=e.lines.filter(h=>h.viewVisualizationEnabled),n=t.length;for(;s.length>n;)s.pop().destroy();const i=I;for(;s.length<n;){const h=new $({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:i.width-i.outlineSize,width:i.width,falloff:i.falloff,color:i.outlineColor,renderOccluded:i.renderOccluded});s.push(h)}const l=a.spatialReference;for(let h=0;h<n;++h){const r=s[h],o=t[n-1-h];r.geometry=this._createLineGeometry(o,l),r.innerColor=T(x.toUnitRGBA(o.color))}}_createLineGeometry(a,e){const s=z(a.samples,[]),t=s.length-1,n=[];let i=[];for(let l=0;l<=t;l++){const{x:h,y:r,z:o}=s[l];E(o)&&i.push([h,r,o]),(l===t||_(o))&&i.length&&(n.push(i),i=[])}return new C({paths:n,hasZ:!0,spatialReference:e})}_destroyVisualElements(){this._visualElements.forEach(a=>a.destroy()),this._visualElements.length=0}};m([f()],p.prototype,"view",void 0),m([f()],p.prototype,"_chartData",void 0),p=m([M("esri.widgets.ElevationProfile.support.ProfileLines3D")],p);class Y{constructor(e,s){this._handles=new R,this._inputRepresentation=new U({view:e}),this._hoveredPoints=new A({view:e}),this._profileLines=new p({view:e}),this._handles.add([d(()=>s.viewModel.hoveredPoints,t=>this._hoveredPoints.update(t),c),d(()=>{const{state:t,editable:n,highlightEnabled:i,viewModel:l}=s,h=l.input;return w(h,r=>{r.commitProperty("geometry"),r.commitProperty("layer")}),{input:h,state:t,editable:n,highlightEnabled:i}},t=>this._updateInputRepresentation(t),c),d(()=>s.viewModel.chartData,t=>this._profileLines.update(t),c),d(()=>w(s.viewModel.input,t=>t.geometry),()=>{this._profileLines.remove()},c)])}destroy(){this._handles=u(this._handles),this._inputRepresentation=u(this._inputRepresentation),this._hoveredPoints=u(this._hoveredPoints),this._profileLines=u(this._profileLines)}_updateInputRepresentation({input:e,state:s,editable:t,highlightEnabled:n}){const i=this._inputRepresentation;if(!n)return i.remove();s===y.Selected?i.showHighlight(e):s!==y.Created||t?i.remove():i.showReshaping(e)}}export{Y as ElevationProfileView3D};
