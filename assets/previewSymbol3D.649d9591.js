var Q=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var _=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var H=(e,s,a)=>s in e?Q(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a,C=(e,s)=>{for(var a in s||(s={}))_.call(s,a)&&H(e,a,s[a]);if(F)for(var a of F(s))ee.call(s,a)&&H(e,a,s[a]);return e},N=(e,s)=>X(e,Y(s));import{qe as $,aB as se,V as z,qf as te,qg as j,qh as ae,jf as G,fB as w,b4 as T,qi as re,b6 as ne,qj as oe,O as M,qk as J,ql as le,qm as ie,qn as ce,qo as pe,qp as ue,qq as he,qr as me,qs as fe,en as ye,qt as E,qu as de,qv as be}from"./vendor.c28ea743.js";import{y as ve,p as ge}from"./colorUtils.7c4b6dc5.js";import{l as Z,d as ke}from"./renderUtils.5dca719b.js";import{resolveWebStyleSymbol as we}from"./webStyleSymbolUtils.97c26dde.js";const L=$.size,O=$.maxSize,A=$.maxOutlineSize,U=$.lineWidth,R=$.tallSymbolWidth,xe=se.getLogger("esri.symbols.support.previewSymbol3D");function q(e){const s=e.outline,a=M(e.material)?e.material.color:null,t=M(a)?a.toHex():null;if(z(s)||"pattern"in s&&M(s.pattern)&&s.pattern.type==="style"&&s.pattern.style==="none")return e.type==="fill"&&t==="#ffffff"?{color:"#bdc3c7",width:.75}:null;const r=w(s.size)||0;return{color:"rgba("+(M(s.color)?s.color.toRgba():"255,255,255,1")+")",width:Math.min(r,A),style:"pattern"in s&&M(s.pattern)&&s.pattern.type==="style"?J(s.pattern.style):null,join:"butt",cap:"patternCap"in s?s.patternCap:"butt"}}function Me(e,s){const a=s&&s.resource,t=a&&a.href;if(e.thumbnail&&e.thumbnail.url)return Promise.resolve(e.thumbnail.url);if(t&&s.type!=="object")return Promise.resolve(oe(e,s));const r=G("esri/images/Legend/legend3dsymboldefault.png");return e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)?we(e.styleOrigin,{portal:e.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var o;return(n==null||(o=n.thumbnail)==null?void 0:o.url)||r}):Promise.resolve(r)}function I(e,s=1){const a=e.a,t=ve(e),r=t.h,n=t.s/s,o=100-(100-t.v)/s,{r:p,g:y,b:h}=ge({h:r,s:n,v:o});return[p,y,h,a]}function D(e){return e.type==="water"?z(e.color)?null:e.color:z(e.material)||z(e.material.color)?null:e.material.color}function i(e,s=0){const a=D(e);if(!a){if(e.type==="fill")return null;const r=te.r,n=j(r,s);return[n,n,n,100]}const t=a.toRgba();for(let r=0;r<3;r++)t[r]=j(t[r],s);return t}async function Le(e,s){const a=e.style;return a==="none"?null:{type:"pattern",x:0,y:0,src:await ae(G(`esri/symbols/patterns/${a}.png`),s.toCss(!0)),width:5,height:5}}function V(e){return e.outline?q(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function K(e,s){const a=D(e);if(!a)return null;let t="rgba(";return t+=j(a.r,s)+",",t+=j(a.g,s)+",",t+=j(a.b,s)+",",t+a.a+");"}function W(e,s){const a=K(e,s);return a?"pattern"in e&&M(e.pattern)&&e.pattern.type==="style"&&e.pattern.style==="none"?null:{color:a,width:Math.min(e.size?w(e.size):.75,A),style:"pattern"in e&&M(e.pattern)&&e.pattern.type==="style"?J(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?e.join==="miter"?w(2):e.join:null}:{}}function P(e,s,a){const t=.75*a;return{type:"linear",x1:t?.25*t:0,y1:t?.5*t:0,x2:t||4,y2:t?.5*t:4,colors:[{color:e,offset:0},{color:s,offset:1}]}}function qe(e){const s=e.depth,a=e.height,t=e.width;return t&&s&&a&&t===s&&t<a}function ze(e,s,a){const t=[];if(!e)return t;switch(e.type){case"icon":{const o=s,p=s;switch(e.resource&&e.resource.primitive||fe){case"circle":t.push({shape:{type:"circle",cx:0,cy:0,r:.5*s},fill:i(e,0),stroke:q(e)});break;case"square":t.push({shape:{type:"path",path:[{command:"M",values:[0,p]},{command:"L",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,p]},{command:"Z",values:[]}]},fill:i(e,0),stroke:q(e)});break;case"triangle":t.push({shape:{type:"path",path:[{command:"M",values:[0,p]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,p]},{command:"Z",values:[]}]},fill:i(e,0),stroke:q(e)});break;case"cross":t.push({shape:{type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,p]},{command:"M",values:[0,.5*p]},{command:"L",values:[o,.5*p]}]},stroke:V(e)});break;case"x":t.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,p]},{command:"M",values:[o,0]},{command:"L",values:[0,p]}]},stroke:V(e)});break;case"kite":t.push({shape:{type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*p]},{command:"L",values:[.5*o,p]},{command:"Z",values:[]}]},fill:i(e,0),stroke:q(e)})}break}case"object":switch(e.resource&&e.resource.primitive||le){case"cone":{const r=P(i(e,0),i(e,-.6),a?R:s),n=me(s,a);t.push({shape:n[0],fill:r}),t.push({shape:n[1],fill:r});break}case"inverted-cone":{const r=i(e,0),n=P(r,i(e,-.6),s),o=he(s);t.push({shape:o[0],fill:n}),t.push({shape:o[1],fill:r});break}case"cube":{const r=ue(s,a);t.push({shape:r[0],fill:i(e,0)}),t.push({shape:r[1],fill:i(e,-.3)}),t.push({shape:r[2],fill:i(e,-.5)});break}case"cylinder":{const r=P(i(e,0),i(e,-.6),a?R:s),n=pe(s,a);t.push({shape:n[0],fill:r}),t.push({shape:n[1],fill:r}),t.push({shape:n[2],fill:i(e,0)});break}case"diamond":{const r=ce(s);t.push({shape:r[0],fill:i(e,-.3)}),t.push({shape:r[1],fill:i(e,0)}),t.push({shape:r[2],fill:i(e,-.3)}),t.push({shape:r[3],fill:i(e,-.7)});break}case"sphere":{const r=P(i(e,0),i(e,-.6));r.x1=0,r.y1=0,r.x2=.25*s,r.y2=.25*s,t.push({shape:{type:"circle",cx:0,cy:0,r:.5*s},fill:r});break}case"tetrahedron":{const r=ie(s);t.push({shape:r[0],fill:i(e,-.3)}),t.push({shape:r[1],fill:i(e,0)}),t.push({shape:r[2],fill:i(e,-.6)});break}}break}return t}function B(e){const s=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null;return s?w(s):null}function Se(e){return e.type==="icon"?"multiply":"tint"}function je(e,s){const a=B(s),t=s&&s.maxSize?w(s.maxSize):null,r=s&&s.disableUpsampling,n=e.symbolLayers,o=[];let p=0,y=0;const h=n.getItemAt(n.length-1);let d;return h&&h.type==="icon"&&(d=h.size&&w(h.size)),n.forEach(f=>{if(f.type!=="icon"&&f.type!=="object")return;const c=f.type==="icon"?f.size&&w(f.size):0,u=a||c?Math.ceil(Math.min(a||c,t||O)):L;if(f&&f.resource&&f.resource.href){const l=Me(e,f).then(function(m){const b=f.get("material.color"),v=Se(f);return ke(m,u,b,v,r)}).then(function(m){const b=m.width,v=m.height;return p=Math.max(p,b),y=Math.max(y,v),[{shape:{type:"image",x:0,y:0,width:b,height:v,src:m.url},fill:null,stroke:null}]});o.push(l)}else{var k;let l=u;f.type==="icon"&&d&&a&&(l=u*(c/d));const m=(s==null?void 0:s.symbolConfig)==="tall"||(s==null||(k=s.symbolConfig)==null?void 0:k.isTall)||f.type==="object"&&qe(f);p=Math.max(p,m?R:l),y=Math.max(y,l),o.push(Promise.resolve(ze(f,l,m)))}}),ne(o).then(function(f){const c=[];return f.forEach(function(u){u.value?c.push(u.value):u.error&&xe.warn("error while building swatchInfo!",u.error)}),Z(c,[p,y],{node:s&&s.node,scale:!1,opacity:s&&s.opacity})})}function $e(e,s){const a=e.symbolLayers,t=[],r=ye(e),n=B(s),o=(s&&s.maxSize?w(s.maxSize):null)||A;let p,y=0,h=0;return a.forEach((d,f)=>{if(!d||d.type!=="line"&&d.type!=="path")return;const c=[];switch(d.type){case"line":{const u=W(d,0);if(z(u))break;const k=u&&u.width||0;f===0&&(p=k);const l=Math.min(n||k,o),m=f===0?l:n?l*(k/p):l,b=m>U/2?2*m:U;h=Math.max(h,m),y=Math.max(y,b),u.width=m,c.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[y,.5*h]}]},stroke:u});break}case"path":{const u=Math.min(n||L,o),k=i(d,0),l=i(d,-.2),m=K(d,-.4),b=m?{color:m,width:1}:{};if(d.profile==="quad"){const v=d.width,g=d.height,x=re(v&&g?v/g:1,g===0,v===0),S=N(C({},b),{join:"bevel"});c.push({shape:x[0],fill:l,stroke:S}),c.push({shape:x[1],fill:l,stroke:S}),c.push({shape:x[2],fill:k,stroke:S})}else c.push({shape:E.pathSymbol3DLayer[0],fill:l,stroke:b}),c.push({shape:E.pathSymbol3DLayer[1],fill:k,stroke:b});h=Math.max(h,u),y=h}}t.push(c)}),Promise.resolve(Z(t,[y,h],{node:s&&s.node,scale:r,opacity:s&&s.opacity}))}async function Pe(e,s){const a=e.type==="mesh-3d",t=e.symbolLayers,r=B(s),n=s&&s.maxSize?w(s.maxSize):null,o=r||L,p=[];let y=0,h=0,d=!1;for(let f=0;f<t.length;f++){const c=t.getItemAt(f),u=[];if(a&&c.type!=="fill")continue;const k=E.fill[0];switch(c.type){case"fill":{const l=q(c),m=Math.min(o,n||O);y=Math.max(y,m),h=Math.max(h,m),d=!0;let b=i(c,0);const v="pattern"in c&&c.pattern,g=D(c);!a&&M(v)&&v.type==="style"&&v.style!=="solid"&&g&&(b=await Le(v,g)),u.push({shape:k,fill:b,stroke:l});break}case"line":{const l=W(c,0);if(z(l))break;const m={stroke:l,shape:k};y=Math.max(y,L),h=Math.max(h,L),u.push(m);break}case"extrude":{const l=C({join:"round",width:1},W(c,-.4)),m=i(c,0),b=i(c,-.2),v=Math.min(o,n||O),g=de(v);l.width=1,u.push({shape:g[0],fill:b,stroke:l}),u.push({shape:g[1],fill:b,stroke:l}),u.push({shape:g[2],fill:m,stroke:l});const x=L,S=.7*L+.5*v;y=Math.max(y,x),h=Math.max(h,S);break}case"water":{const l=D(c),m=I(l),b=I(l,2),v=I(l,3),g=be();d=!0,u.push({shape:g[0],fill:m}),u.push({shape:g[1],fill:b}),u.push({shape:g[2],fill:v});const x=Math.min(o,n||O);y=Math.max(y,x),h=Math.max(h,x);break}}p.push(u)}return Promise.resolve(Z(p,[y,h],{node:s&&s.node,scale:d,opacity:s&&s.opacity}))}function Re(e,s){if(e.symbolLayers.length===0)return Promise.reject(new T("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return je(e,s);case"line-3d":return $e(e,s);case"polygon-3d":case"mesh-3d":return Pe(e,s)}return Promise.reject(new T("symbolPreview: swatchInfo3D","symbol not supported."))}export{Le as getPatternDescriptor,B as getSizeFromOptions,i as getSymbolLayerFill,Re as previewSymbol3D};
