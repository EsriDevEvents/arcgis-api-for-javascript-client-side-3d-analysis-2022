var Te=Object.defineProperty,xe=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Ge=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var be=(e,t,i)=>t in e?Te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,b=(e,t)=>{for(var i in t||(t={}))Ge.call(t,i)&&be(e,i,t[i]);if(we)for(var i of we(t))je.call(t,i)&&be(e,i,t[i]);return e},P=(e,t)=>xe(e,Re(t));import{aB as Ne,J as r,K as o,L as pe,M as ge,G as me,aM as w,be as ce,Z as L,hK as ke,bq as fe,aa as z,ab as A,V as m,nb as Ie,my as Ue,mt as D,dR as Z,cR as ue,c1 as We,nc as He,nd as qe,ne as Qe,O as G,mf as Le,nf as Fe,mv as Be,mw as Ke,kJ as Xe,dp as O,kM as ee,kP as te,mD as X,kR as Je,kQ as Ye,kS as Ze,kT as et,kU as tt,mE as it,mG as st,kV as at,ng as nt,mH as rt,kW as ot,kX as lt,kY as dt,lb as ht,nh as ct,mK as ut,lg as pt,kK as gt,mO as mt,mP as _t,bf as ie,cc as se,cb as Ve,cd as vt,hV as ae,dh as yt,e4 as wt,dj as R,ni as W,dA as H,dn as bt,cT as _e,di as ft,nj as E,nk as y,mQ as q,fn as ne,mR as Lt,bi as Pt,bh as Ot,mW as St,mS as Ct,mT as Et,mY as zt,d6 as Pe,dc as At,el as Me,n8 as ve,aG as Vt,mZ as Mt}from"./vendor.c28ea743.js";import{p as Dt}from"./AnalysisView3D.1c8e19f7.js";import{t as $t,e as Q,b as re,f as Oe,_ as x,d as F,y as oe,g as Tt,h as le,s as xt,a as de,i as he,w as Se}from"./Segment.f685ccc7.js";import{z as Rt}from"./RightAngleQuadVisualElement.94368e72.js";const Gt=Ne.getLogger("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController"),jt=1e5;let V=class extends ge{constructor(e){super(e),this._unitNormalizer=new $t,this._handles=new me,this._tempStartPosition=w(),this._tempEndPosition=w(),this._tempCornerPosition=w()}initialize(){this._handles.add(ce(this.view,"ready",()=>this._initialize(),!0))}destroy(){this._handles=L(this._handles)}_initialize(){const e=this.view.spatialReference,t=ke(e),i=t===Be?Ke:t;this._sphericalPCPF=i;const s=fe(e,i);this._unitNormalizer.spatialReference=s?i:e,this._handles.add([z(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:a,startPoint:n})=>{a.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(n)},A),z(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:a,endPoint:n})=>{a.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(n)},A),z(()=>({result:this._computedResult,viewData:this.viewData}),({result:a,viewData:n})=>{n.result=a},A)])}_applyProjectionAndElevationAlignment(e){if(m(e))return e;const t=Ie(e,this.view.spatialReference,this.view.elevationProvider);return m(t)?(Ue(this.analysis,e.spatialReference,Gt),null):t}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:i}=this.viewData;if(m(e)||m(t))return null;const s=this._euclideanDistances(e,t),a=this._geodesicDistance(e,t,s.horizontal.value),n=i===D.Geodesic||i===D.Auto&&s.horizontal.value>jt?"geodesic":"euclidean";return{mode:n,distance:n==="euclidean"?s.direct:a,directDistance:s.direct,horizontalDistance:s.horizontal,verticalDistance:s.vertical,geodesicDistance:a}}_euclideanDistances(e,t){const i=e.clone();i.z=t.z;const s=this._tempStartPosition,a=this._tempEndPosition,n=this._tempCornerPosition,c=this.view.spatialReference,d=this._sphericalPCPF,l=fe(c,d)?d:c;Z(e,s,l),Z(t,a,l),Z(i,n,l);const h=ue(s,a),u=ue(n,a),_=Math.abs(t.z-e.z),v=N=>this._unitNormalizer.normalizeDistance(N),f=v(h),$=v(u),j=v(_);return{direct:Q(f,"meters"),horizontal:Q($,"meters"),vertical:Q(j,"meters")}}_geodesicDistance(e,t,i){const s=e.spatialReference,a=new We({spatialReference:s});a.addPath([e,t]);const n=s.isGeographic&&He(s)?qe([a],"meters")[0]:s.isWebMercator?Qe(a,"meters"):null,c=G(n)?n:this._fallbackGeodesicDistance(e,t,i);return Q(c,"meters")}_fallbackGeodesicDistance(e,t,i){if(Le(e,Ce)&&Le(t,Ee)){const s={distance:0};return Fe(s,Ce,Ee),s.distance}return i}};r([o()],V.prototype,"view",void 0),r([o()],V.prototype,"analysis",void 0),r([o()],V.prototype,"viewData",void 0),r([o()],V.prototype,"_computedResult",null),V=r([pe("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],V);const Ce=w(),Ee=w();function Nt(){const e=new Xe;e.vertex.uniforms.add("proj","mat4").add("view","mat4").add("width","float"),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.NORMAL,"vec3"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"float"),e.varyings.add("vtc","vec2"),e.varyings.add("vlength","float"),e.varyings.add("vradius","float"),e.vertex.code.add(ee`void main(void) {
vec3 bitangent = normal;
vtc = uv0;
vlength = auxpos1;
vradius = 0.5 * width;
vec4 pos = view * vec4(position + vradius * bitangent * uv0.y, 1.0);
gl_Position = proj * pos;
}`),e.fragment.uniforms.add("outlineSize","float").add("outlineColor","vec4").add("stripeLength","float").add("stripeEvenColor","vec4").add("stripeOddColor","vec4");const t=1/Math.sqrt(2);return e.fragment.code.add(ee`
    const float INV_SQRT2 = ${ee.float(t)};

    vec4 arrowColor(vec2 tc, float len) {
      float d = INV_SQRT2 * (tc.x - abs(tc.y));
      d = min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));
      d = min(d, 1.0 - abs(tc.y));

      if (d < 0.0) {
        return vec4(0.0);
      } else if (d < outlineSize) {
        return outlineColor;
      } else {
        return fract(0.5 / stripeLength * tc.x * vradius) >= 0.5 ? stripeOddColor : stripeEvenColor;
      }
    }

    void main(void) {
      vec2 ntc = vec2(vtc.x / vradius, vtc.y);
      vec4 color = arrowColor(ntc, vlength / vradius);
      if (color.a == 0.0) {
        discard;
      }
      gl_FragColor = color;
    }
  `),e}const kt=Object.freeze({__proto__:null,build:Nt});class J extends Ze{constructor(t,i,s){super(t,i,s)}initializeProgram(t){const i=J.shader.get().build();return new et(t.rctx,i,tt)}bindPass(t,i){it(this.program,i.camera.projectionMatrix),this.program.setUniform1f("width",t.width),this.program.setUniform1f("outlineSize",t.outlineSize),this.program.setUniform4fv("outlineColor",t.outlineColor),this.program.setUniform1f("stripeLength",t.stripeLength),this.program.setUniform4fv("stripeEvenColor",t.stripeEvenColor),this.program.setUniform4fv("stripeOddColor",t.stripeOddColor)}bindDraw(t){st(this.program,t),this.program.rebindTextures()}_setPipelineState(t){const i=t===X.NONE,s=this.configuration;return at({blending:s.transparent?i?nt:rt(t):null,polygonOffset:this.configuration.polygonOffsetEnabled&&{factor:0,units:-4},depthTest:{func:ot.LESS},depthWrite:lt,colorWrite:dt})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return ht.TRIANGLE_STRIP}}J.shader=new Ye(kt,()=>import("./MeasurementArrow.glsl.fbca6a79.js"));class B extends Je{constructor(){super(...arguments),this.polygonOffsetEnabled=!1,this.transparent=!1,this.transparencyPassType=X.NONE}}r([te()],B.prototype,"polygonOffsetEnabled",void 0),r([te()],B.prototype,"transparent",void 0),r([te({count:X.COUNT})],B.prototype,"transparencyPassType",void 0);class It extends ut{constructor(t){super(t,Wt),this.techniqueConfig=new B}getTechniqueConfig(t,i){var s;return this.techniqueConfig.polygonOffsetEnabled=this.parameters.polygonOffset,this.techniqueConfig.transparent=this.parameters.stripeEvenColor[3]<1||this.parameters.stripeOddColor[3]<1||this.parameters.outlineColor[3]<1,this.techniqueConfig.transparencyPassType=(s=i==null?void 0:i.transparencyPassType)!=null?s:X.NONE,this.techniqueConfig}dispose(){}getPassParameters(){return this.parameters}intersect(){}requiresSlot(t){return t===pt.OPAQUE_MATERIAL}createGLMaterial(t){return t.output===gt.Color?new Ut(t):null}createBufferWriter(){return new Xt}}class Ut extends mt{updateParameters(t){return this.ensureTechnique(J,t)}beginSlot(t){return this.updateParameters(t)}bind(t,i){i.bindPass(this._material.getPassParameters(),t)}}const Wt=b({width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,1],stripeOddColor:[1,.5,0,1],polygonOffset:!1},_t),Ht=ct().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).f32(O.AUXPOS1),qt=w(),Qt=w(),Ft=w(),Bt=w(),Kt=w();class Xt{constructor(){this.vertexBufferLayout=Ht}allocate(t){return this.vertexBufferLayout.createBuffer(t)}elementCount(t){return 2*(t.indices.get(O.POSITION).length/2+1)}write(t,i,s,a){const n=i.vertexAttributes.get(O.POSITION).data,c=i.vertexAttributes.get(O.NORMAL).data,d=n.length/3,l=i&&i.indices&&i.indices.get(O.POSITION);l&&l.length!==2*(d-1)&&console.warn("MeasurementArrowMaterial does not support indices");const h=qt,u=Qt,_=Ft,v=Bt,f=Kt,$=t.transformation,j=t.invTranspTransformation,N=s.position,ye=s.normal,k=s.uv0;let I=0;for(let S=0;S<d;++S){const Y=3*S;if(ie(h,n[Y],n[Y+1],n[Y+2]),S<d-1){const M=3*(S+1);ie(u,n[M],n[M+1],n[M+2]),ie(f,c[M],c[M+1],c[M+2]),se(f,f),Ve(_,u,h),se(_,_),vt(v,f,_),se(v,v)}const $e=ue(h,u);$&&j&&(ae(h,h,$),ae(u,u,$),ae(v,v,j));const T=a+2*S,U=T+1;N.setVec(T,h),N.setVec(U,h),ye.setVec(T,v),ye.setVec(U,v),k.set(T,0,I),k.set(T,1,-1),k.set(U,0,I),k.set(U,1,1),S<d-1&&(I+=$e)}const De=s.auxpos1;for(let S=0;S<2*d;++S)De.set(a+S,I)}}class Jt extends yt{constructor(t){super(t),this._parameters=Yt,this._handles=null,this._origin=w(),this._originTransform=wt(),this._arrowCenter=w(),this._renderOccluded=R.OccludeAndTransparent,this._geometry=null,this._stripeLength=1,this._stripesEnabled=!0,this._opacity=1,this.applyProps(t)}get renderOccluded(){return this._renderOccluded}set renderOccluded(t){t!==this._renderOccluded&&(this._renderOccluded=t,this._arrowMaterial&&this._arrowMaterial.setParameters({renderOccluded:t}))}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this._geometryChanged()}get stripeLength(){return this._stripeLength}set stripeLength(t){this._stripeLength=t,this.attached&&this._arrowMaterial.setParameters({stripeLength:this._stripeLength})}get stripesEnabled(){return this._stripesEnabled}set stripesEnabled(t){if(this._stripesEnabled=t,this.attached){const i=this.opacity,{arrowStripeEvenColor:s,arrowStripeOddColor:a}=this._parameters,n=W(ze,this._stripesEnabled?s:a,i);this._arrowMaterial.setParameters({stripeEvenColor:n})}}get opacity(){return this._opacity}set opacity(t){t!==this._opacity&&(this._opacity=t,this._updateArrowOpacity())}createExternalResources(){const{arrowStripeEvenColor:t,arrowStripeOddColor:i,arrowOutlineColor:s}=this._parameters,a=this._stripesEnabled?t:i;this._arrowMaterial=new It({outlineColor:s,stripeEvenColor:a,stripeOddColor:i,renderOccluded:this.renderOccluded,polygonOffset:!0}),this._handles=new me,this._handles.add(this.view.state.watch("camera",()=>{this._viewChanged()}))}destroyExternalResources(){this._arrowMaterial=null,this._handles.destroy(),this._handles=null}forEachExternalMaterial(t){t(this._arrowMaterial)}createGeometries(t){if(m(this._geometry)||m(this._geometry.startRenderSpace)||m(this._geometry.endRenderSpace))return;const i=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);t.addGeometry(i,this._arrowMaterial,this._originTransform),this._viewChanged()}_createArrowGeometry(t,i,s,a){const n=this.view.renderCoordsHelper,c=[],d=[],l=(h,u)=>{const _=H.get();Ve(_,h,s),c.push(_),d.push(u)};if(a.type==="euclidean"){a.eval(.5,this._arrowCenter);const h=H.get();n.worldUpAtPosition(this._arrowCenter,h),l(t,h),l(i,h)}else{a.eval(.5,this._arrowCenter);const h=this._parameters.arrowSubdivisions+1&-2;for(let u=0;u<h;++u){const _=u/(h-1),v=H.get(),f=H.get();a.eval(_,v),n.worldUpAtPosition(v,f),l(v,f)}}return bt.createPolylineGeometry(c,d)}_geometryChanged(){this.recreateGeometry()}_viewChanged(){if(this.view.ready&&this.attached&&G(this._geometry)){const t=this.view.state.camera.computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameters({width:this._parameters.arrowWidth*t})}}_updateArrowOpacity(){const t=this.opacity,{arrowStripeEvenColor:i,arrowStripeOddColor:s,arrowOutlineColor:a}=this._parameters,n=W(ze,this._stripesEnabled?i:s,t),c=W(Zt,a,t),d=W(ei,s,t);this._arrowMaterial.setParameters({stripeEvenColor:n,outlineColor:c,stripeOddColor:d})}}const Yt={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128},ze=_e(),Zt=_e(),ei=_e();var C;(function(e){e[e.Pending=0]="Pending",e[e.Ready=1]="Ready",e[e.Destroyed=2]="Destroyed"})(C||(C={}));let g=class extends ge{constructor(e){super(e),this._params=b({},ii),this._handles=new me,this._segmentVisualElement=null,this._triangleVisualElement=null,this._rightAngleQuad=null,this._projectedGeodesicLine=null,this._geodesicStartHint=null,this._geodesicEndHint=null,this._segmentLabel=null,this._verticalLabel=null,this._horizontalLabel=null,this._startPosition=w(),this._endPosition=w(),this._cornerPosition=w(),this._startPositionAtSeaLevel=w(),this._endPositionAtSeaLevel=w(),this._state=C.Pending,this._triangleOrientationOverride=null,this.messages=null,this.loadingMessages=!0,this.visualElementOrientation=E.Auto,this.triangleCollapseRatioThreshold=.03}get ready(){return this._state===C.Ready}get visible(){return this.analysisView.visible}get viewMode(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t}=this.analysisView;if(m(e)||m(t)||e.equals(t))return y.None;const i=this.analysisView.result;if(m(i))return y.Direct;if(i.mode==="geodesic")return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?y.ProjectedGeodesic:y.Direct;const{verticalDistance:s,horizontalDistance:a}=i,n=s.value,c=a.value;return Math.min(n/c,c/n)<this.triangleCollapseRatioThreshold?y.Direct:y.Triangle}get actualVisualizedMeasurement(){if(m(this.analysisView.result))switch(this.analysisView.measurementMode){case D.Auto:case D.Euclidean:default:return"euclidean";case D.Geodesic:return"geodesic"}return this.analysisView.result.mode}get allowVisualElementsOrientationChange(){return m(this._triangleOrientationOverride)}set allowVisualElementsOrientationChange(e){m(this._triangleOrientationOverride)!==e&&(m(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}get labels(){const e=this.actualVisualizedMeasurement==="geodesic";return{direct:this._segmentLabel,horizontal:e?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}get testData(){var e;return{labels:this.labels,stripeLength:(e=this._segmentVisualElement)==null?void 0:e.stripeLength}}initialize(){this._handles.add(ce(this.view,"ready",()=>this._initialize(),!0))}_initialize(){switch(this._state){case C.Ready:throw new Error("invalid state");case C.Destroyed:return}const e=this._params,t={attached:!0,view:this.view};this._segmentVisualElement=new Jt(P(b({},t),{geometry:null,renderOccluded:R.OccludeAndTransparent})),this._triangleVisualElement=new q(P(b({},t),{width:e.triangleLineWidth,color:e.triangleColor,renderOccluded:R.OccludeAndTransparent})),this._rightAngleQuad=new Rt(P(b({},t),{color:K,renderOccluded:R.OccludeAndTransparent}));const i=P(b({},t),{polygonOffset:!0,renderOccluded:R.OccludeAndTransparent});this._projectedGeodesicLine=new q(P(b({},i),{width:e.geodesicProjectionLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:ne(e.guideStippleLengthPixels)})),this._geodesicStartHint=new q(P(b({},i),{width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:ne(e.guideStippleLengthPixels)})),this._geodesicEndHint=new q(P(b({},i),{width:e.guideLineWidth,color:e.geodesicProjectionLineColor,stipplePattern:ne(e.guideStippleLengthPixels)})),this._segmentLabel=new re(P(b({},t),{fontSize:e.direcLabelFontSize})),this._verticalLabel=new re(P(b({},t),{fontSize:e.verticalLabelFontSize})),this._horizontalLabel=new re(P(b({},t),{fontSize:e.horizontalLabelFontSize})),this._handles.add([z(()=>{const{elevationAlignedStartPoint:s,elevationAlignedEndPoint:a}=this.analysisView,n=this.view;return{view:n,camera:n.state.camera,viewMode:this.viewMode,elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},s=>this._updateGeometryAndViewMode(s),A),z(()=>({visible:this.visible,viewMode:this.viewMode}),s=>this._updateVisualElementVisibility(s),A),z(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),s=>this._updateLabelText(s),A),z(()=>({visible:this.visible,viewMode:this.viewMode,state:this._state}),s=>this._updateLabelVisibility(s),A),z(()=>this._measurementArrowStripeLength,s=>this._updateSegmentStripeLength(s),A),Lt(async()=>this._updateMessageBundle())]),this._state=C.Ready,this._updateMessageBundle()}destroy(){this._state!==C.Destroyed&&(this._handles=L(this._handles),this._segmentVisualElement=L(this._segmentVisualElement),this._triangleVisualElement=L(this._triangleVisualElement),this._rightAngleQuad=L(this._rightAngleQuad),this._projectedGeodesicLine=L(this._projectedGeodesicLine),this._geodesicStartHint=L(this._geodesicStartHint),this._geodesicEndHint=L(this._geodesicEndHint),this._segmentLabel=L(this._segmentLabel),this._verticalLabel=L(this._verticalLabel),this._horizontalLabel=L(this._horizontalLabel),this.set("view",null),this._state=C.Destroyed)}async whenReady(){await ce(this,"ready")}_updateVisualElementVisibility({visible:e,viewMode:t}){if(this._segmentVisualElement.visible=!1,this._triangleVisualElement.visible=!1,this._rightAngleQuad.visible=!1,this._projectedGeodesicLine.visible=!1,this._geodesicStartHint.visible=!1,this._geodesicEndHint.visible=!1,e)switch(t){case y.None:break;case y.Direct:this._segmentVisualElement.visible=!0;break;case y.Triangle:this._segmentVisualElement.visible=!0,this._triangleVisualElement.visible=!0,this._rightAngleQuad.visible=!0;break;case y.ProjectedGeodesic:this._segmentVisualElement.visible=!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}}_updateGeometryAndViewMode({view:e,camera:t,viewMode:i,elevationAlignedStartPoint:s,elevationAlignedEndPoint:a,orientation:n,visualizedMeasurement:c,stripeLength:d}){const l=e.renderCoordsHelper;if(m(s)||m(a)||s.equals(a))return;let h=this._startPosition,u=this._endPosition;l.toRenderCoords(s,h),l.toRenderCoords(a,u);const _=n===E.AboveSegment?1:-1,v=_*(l.getAltitude(u)-l.getAltitude(h));v<0&&(h=this._endPosition,u=this._startPosition);const f=c==="geodesic"?new Oe(this._startPosition,this._endPosition,l.spatialReference):new x(this._startPosition,this._endPosition);switch(this._segmentVisualElement.geometry=f,this._updateSegmentStripeLength(d),i){case y.Direct:this._updateSegment(f,n);break;case y.Triangle:this._updateSegmentAndTriangle({view:e,camera:t,segment:f,orientation:n,startPosition:h,endPosition:u,deltaSign:_,altitudeDelta:v});break;case y.ProjectedGeodesic:this._updateSegmentAndProjection({view:e,orientation:n,startPosition:h,endPosition:u})}}_updateSegment(e,t){this._segmentLabel.anchor=t===E.AboveSegment?"top":"bottom",this._segmentLabel.geometry={type:"segment",segment:e,sampleLocation:"center"}}_updateSegmentAndTriangle({view:{renderCoordsHelper:e},camera:t,segment:i,orientation:s,startPosition:a,endPosition:n,deltaSign:c,altitudeDelta:d}){const l=this._cornerPosition;e.worldUpAtPosition(a,l),Pt(l,l,c*Math.abs(d)),Ot(l,l,a),this._triangleVisualElement.geometry=[[[a[0],a[1],a[2]],[l[0],l[1],l[2]],[n[0],n[1],n[2]]]],this._rightAngleQuad.geometry={previous:a,center:l,next:n};const h=new x(a,l),u=new x(l,n),_=ti(a,n,l,s,t);this._segmentLabel.anchor=_.segment,this._segmentLabel.geometry={type:"segment",segment:i,sampleLocation:"center"},this._verticalLabel.geometry={type:"segment",segment:h,sampleLocation:"center"},this._verticalLabel.anchor=_.vertical,this._horizontalLabel.geometry={type:"segment",segment:u,sampleLocation:"center"},this._horizontalLabel.anchor=_.horizontal}_updateSegmentAndProjection({view:{renderCoordsHelper:e},orientation:t,startPosition:i,endPosition:s}){e.setAltitude(this._startPositionAtSeaLevel,0,i),e.setAltitude(this._endPositionAtSeaLevel,0,s);const a=new Oe(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,e.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a),this._geodesicStartHint.setGeometryFromSegment(new x(this._startPositionAtSeaLevel,i)),this._geodesicEndHint.setGeometryFromSegment(new x(this._endPositionAtSeaLevel,s)),this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"},this._segmentLabel.anchor=t===E.AboveSegment?"top":"bottom"}_updateLabelText({text:e,visualizedMeasurement:t}){G(e)?(this._segmentLabel.text=t==="euclidean"?e.euclideanDistance:e.geodesicDistance,this._horizontalLabel.text=e.horizontalDistance,this._verticalLabel.text=e.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null),this.notifyChange("labels")}_updateLabelVisibility({state:e,visible:t,viewMode:i}){if(e!==C.Ready)return;const s=this._segmentLabel,a=this._horizontalLabel,n=this._verticalLabel;if(s.visible=!1,a.visible=!1,n.visible=!1,t)switch(i){case y.Direct:s.visible=!0;break;case y.Triangle:s.visible=!0,a.visible=!0,n.visible=!0;break;case y.ProjectedGeodesic:s.visible=!0;case y.None:}}get _labelsText(){if(this._state!==C.Ready)return null;const e=this.messages,t=this.analysisView.result;if(m(t)||m(e))return null;const{directDistance:i,horizontalDistance:s,verticalDistance:a,geodesicDistance:n}=t,c=this.analysisView.unit,d=l=>b({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:""},l);switch(c){case"metric":return d({euclideanDistance:i&&le(e,i),geodesicDistance:n&&le(e,n),horizontalDistance:s&&le(e,s),verticalDistance:a&&xt(e,a)});case"imperial":return d({euclideanDistance:i&&oe(e,i),geodesicDistance:n&&oe(e,n),horizontalDistance:s&&oe(e,s),verticalDistance:a&&Tt(e,a)});default:return d({euclideanDistance:i&&F(e,i,c),geodesicDistance:n&&F(e,n,c),horizontalDistance:s&&F(e,s,c),verticalDistance:a&&F(e,a,c)})}}_updateSegmentStripeLength(e){const t=this._segmentVisualElement;G(e)?(t.stripeLength=e,t.stripesEnabled=!0):t.stripesEnabled=!1}get _actualVisualElementsOrientation(){if(G(this._triangleOrientationOverride))return this._triangleOrientationOverride;const e=this.visualElementOrientation;return e===E.Auto?this.view.state.camera.aboveGround?E.AboveSegment:E.BelowSegment:e}_requiresGeodesicGuideAt(e){const t=this.view;if(t==null||!t.state)return!1;const i=t.state.camera,s=t.renderCoordsHelper,a=i.computeScreenPixelSizeAt(e);return s.getAltitude(e)/a>=10}get _measurementArrowStripeLength(){const{result:e,unit:t}=this.analysisView;if(m(e))return null;let i=null;const s=e.directDistance;switch(t){case"metric":i=s&&de(s,"meters");break;case"imperial":i=s&&de(s,St(s.value,s.unit));break;default:i=s&&de(s,t)}return m(i)?null:Ct(i.value/30)*Et(1,i.unit,"meters")}_updateMessageBundle(){this.loadingMessages=!0,zt("esri/core/t9n/Units").then(e=>{this.messages=e}).finally(()=>{this.loadingMessages=!1})}};function ti(e,t,i,s,a){const n=si,c=ai;a.projectToRenderScreen(i,n),a.projectToRenderScreen(t,c);const d={segment:"bottom",horizontal:"top",vertical:n[0]<c[0]?"left":"right"};{const l=ni,h=ri;if(he(e,i,l,a),he(e,t,h,a),Pe(l,h)>=Ae){const u=Math.sign(l[1])===Math.sign(h[1]);d.segment=u?Se(d.vertical):d.vertical}else{const u=oi;he(i,t,u,a),Pe(u,h)>=Ae&&(d.segment=Math.sign(u[0])===Math.sign(h[0])?Se(d.horizontal):d.horizontal)}}if(s===E.BelowSegment){const l=h=>h==="top"?"bottom":"top";d.segment=l(d.segment),d.horizontal=l(d.horizontal),d.vertical=l(d.vertical)}return d}r([o()],g.prototype,"_state",void 0),r([o()],g.prototype,"_triangleOrientationOverride",void 0),r([o()],g.prototype,"messages",void 0),r([o()],g.prototype,"view",void 0),r([o()],g.prototype,"analysis",void 0),r([o()],g.prototype,"analysisView",void 0),r([o()],g.prototype,"ready",null),r([o()],g.prototype,"loadingMessages",void 0),r([o()],g.prototype,"visible",null),r([o()],g.prototype,"viewMode",null),r([o()],g.prototype,"actualVisualizedMeasurement",null),r([o()],g.prototype,"visualElementOrientation",void 0),r([o()],g.prototype,"triangleCollapseRatioThreshold",void 0),r([o()],g.prototype,"allowVisualElementsOrientationChange",null),r([o()],g.prototype,"labels",null),r([o()],g.prototype,"testData",null),r([o()],g.prototype,"_labelsText",null),r([o()],g.prototype,"_actualVisualElementsOrientation",null),r([o()],g.prototype,"_measurementArrowStripeLength",null),g=r([pe("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],g);const K=ft(1,.5,0,.75),ii={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:K,triangleLineWidth:3,triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:K,guideLineWidth:2,guideLineColor:K,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},Ae=Math.cos(At(12)),si=Me(),ai=Me(),ni=ve(),ri=ve(),oi=ve();let p=class extends Dt(ge){constructor(e){super(e),this.type="direct-line-measurement-view-3d",this.result=null,this.measurementMode=D.Auto,this.elevationAlignedStartPoint=null,this.elevationAlignedEndPoint=null}initialize(){const e=this.view,t=this.analysis;this._analysisVisualization=new g({view:e,analysis:t,analysisView:this}),this._analysisController=new V({view:e,analysis:t,viewData:this})}destroy(){this._analysisController=L(this._analysisController),this._analysisVisualization=L(this._analysisVisualization)}whenReady(){return this._analysisVisualization.whenReady()}get updating(){var e;return!((e=this._analysisVisualization)==null||!e.loadingMessages)}get viewMode(){return this._analysisVisualization.viewMode}get actualVisualizedMeasurement(){return this._analysisVisualization.actualVisualizedMeasurement}get visualElementOrientation(){return this._analysisVisualization.visualElementOrientation}set visualElementOrientation(e){this._analysisVisualization.visualElementOrientation=e}get allowVisualElementsOrientationChange(){return this._analysisVisualization.allowVisualElementsOrientationChange}set allowVisualElementsOrientationChange(e){this._analysisVisualization.allowVisualElementsOrientationChange=e}get triangleCollapseRatioThreshold(){return this._analysisVisualization.triangleCollapseRatioThreshold}set triangleCollapseRatioThreshold(e){this._analysisVisualization.triangleCollapseRatioThreshold=e}get directLabelText(){return this._analysisVisualization.labels.direct.text}get horizontalLabelText(){return this._analysisVisualization.labels.horizontal.text}get verticalLabelText(){return this._analysisVisualization.labels.vertical.text}get testData(){var e;return this.destroyed?{labels:null,stripeLength:null,visualization:null,controller:null}:P(b({},(e=this._analysisVisualization)==null?void 0:e.testData),{visualization:this._analysisVisualization,controller:this._analysisController})}get unit(){return Vt(this.analysis.unit,this._defaultUnit)}};r([o()],p.prototype,"updating",null),r([o()],p.prototype,"type",void 0),r([o()],p.prototype,"analysis",void 0),r([o()],p.prototype,"result",void 0),r([o()],p.prototype,"measurementMode",void 0),r([o()],p.prototype,"elevationAlignedStartPoint",void 0),r([o()],p.prototype,"elevationAlignedEndPoint",void 0),r([o({readOnly:!0})],p.prototype,"viewMode",null),r([o({readOnly:!0})],p.prototype,"actualVisualizedMeasurement",null),r([o()],p.prototype,"visualElementOrientation",null),r([o()],p.prototype,"allowVisualElementsOrientationChange",null),r([o()],p.prototype,"triangleCollapseRatioThreshold",null),r([o({readOnly:!0})],p.prototype,"directLabelText",null),r([o({readOnly:!0})],p.prototype,"horizontalLabelText",null),r([o({readOnly:!0})],p.prototype,"verticalLabelText",null),r([o()],p.prototype,"testData",null),r([o()],p.prototype,"_analysisVisualization",void 0),r([o()],p.prototype,"_analysisController",void 0),r([o()],p.prototype,"unit",null),r([o(Mt)],p.prototype,"_defaultUnit",void 0),p=r([pe("esri.views.3d.analysis.DirectLineMeasurementAnalysisView3D")],p);const li=p;var gi=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:li});export{gi as D,Nt as r};
